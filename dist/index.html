
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/playground.css">
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>    
    <script>window.module = {}</script>
    <script src="js/split.min.js"></script>
    <script src="js/codemirror.js"></script>
    <script src="js/stex.js"></script>
    <script src="js/cm-rulers.js"></script>
    <script src="js/latex-printer.js"></script>
    <!-- <script src="js/main.js"></script> -->
	<script>
		$(document).ready(function () {
			"use strict";
			// set up codemirror
			/*var inCodeTextArea = document.querySelector("#in-code")
			var inCode = CodeMirror(function(el){
				el.id = inCodeTextArea.id;
				inCodeTextArea.parentNode.replaceChild(el, inCodeTextArea);
			},{
				mode: 'stex',
				autofocus: true
			})*/
			var inCode = CodeMirror.fromTextArea(document.querySelector("#in-code"), {mode: "stex", viewportMargin: Infinity, tabSize: 8})
			var outCode = CodeMirror.fromTextArea(document.querySelector("#out-code"), {mode: "stex", viewportMargin: Infinity, tabSize: 8})
			//inCode.setSize("100%", "100%")
			var oldCode = localStorage.getItem("code")
			if (oldCode) {
				inCode.setValue(oldCode)
			}
			window.oc = outCode


			$("#process").click(function (e) {
				var linewidth = parseInt($('#linewidth').val(), 10);
				var printer = $('#printer').find(":selected").val();
				console.log("Processing...", "linewidth", linewidth, "printer", printer);
				var code = inCode.getValue();
				var parsed = exports.parse(code);
				window.ast = parsed;
				//var tokens = parsed.toTokens()
				//$("#out-code").val(exports.printTokenStream(tokens));
				if (printer === "token") {
					outCode.setValue(exports.print(code));
				} else if (printer === "prettier") {
					outCode.setValue(exports.prettierPrint(code, {printWidth: linewidth}));
				}
				outCode.setOption("rulers", [{column: linewidth}])
			})

			$(window).unload(function() {
				// save stuff to local storage
				localStorage.setItem("code", inCode.getValue());
			})


			Split(['#in-container', '#out-container']) 

		});
	</script>
</head>
<body>
	<div id="opts">
	<button id="process">Process</button>
	<input id="linewidth" type="number" value="60">
	Backend: <select id="printer">
		<option value="token">Basic Tokenizer</option>
		<option value="prettier" selected>Prettier.js</option>
	</select>
	</div>
	<div id="tex">
		<div id="in-container">
			<div class="layer-wrap">
	<textarea id="in-code" name="in-code"  rows="30">
\begin{enumerate}
		\item[55,4] Hi there
\item$e^2$ is math mode!
\end{enumerate}
	</textarea>
		</div>
		</div>
		<div id="out-container">
			<div class="layer-wrap">
	<textarea id="out-code" name="out-code" rows="30">
\begin{enumerate, v}
		\item[55,4] [Hi d {there}]

\item$e^2$ is math mode!


\end{enumerate, v}
		
\begin{enumerate}
		\item[55,4] Hi there
\item$e^2$ is math mode!
\end{enumerate}
	</textarea>
			</div>
		</div>
	</div>
</body>
</html>
